<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒå¾Œåçœèˆ‡è¦åŠƒå·¥å…·</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }
        .subject-input {
            appearance: textfield;
        }
        .subject-input::-webkit-outer-spin-button,
        .subject-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .reflection-card {
            border-left: 5px solid;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-6 md:p-10">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700">è€ƒå¾Œè‡ªæˆ‘åçœèˆ‡æˆé•·è¦åŠƒ</h1>
            <p class="mt-2 text-gray-600">ä¸€æ¬¡è€ƒè©¦ï¼Œæ˜¯ä¸€æ¬¡å­¸ç¿’çš„æ©Ÿæœƒã€‚è®“æˆ‘å€‘èª å¯¦åœ°æª¢è¦–éç¨‹èˆ‡çµæœã€‚</p>
        </header>

        <!-- æˆç¸¾è¼¸å…¥å€ -->
        <section id="score-input" class="mb-8 border-b pb-6 border-indigo-200">
            <h2 class="text-2xl font-semibold text-indigo-600 mb-4">ä¸€ã€ è¼¸å…¥æˆç¸¾èˆ‡é æœŸç›®æ¨™ (æ»¿åˆ† 100)</h2>
            
            <!-- å§“åè¼¸å…¥ -->
            <div class="mb-4">
                <label for="student-name" class="block text-lg font-medium text-gray-700 mb-2">å­¸ç”Ÿå§“å</label>
                <input type="text" id="student-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å"
                       class="w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500">
            </div>

            <!-- è€ƒè©¦é¡å‹é¸æ“‡ -->
            <div class="mb-6">
                <label for="exam-period" class="block text-lg font-medium text-gray-700 mb-2">è€ƒè©¦é¡å‹</label>
                <select id="exam-period"
                        class="w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500 bg-white">
                    <option value="" disabled selected>è«‹é¸æ“‡è€ƒè©¦æ™‚é–“/é¡åˆ¥</option>
                    <option value="ä¸Šå­¸æœŸæœŸä¸­è€ƒ">ä¸Šå­¸æœŸæœŸä¸­è€ƒ</option>
                    <option value="ä¸Šå­¸æœŸæœŸæœ«è€ƒ">ä¸Šå­¸æœŸæœŸæœ«è€ƒ</option>
                    <option value="ä¸‹å­¸æœŸæœŸä¸­è€ƒ">ä¸‹å­¸æœŸæœŸä¸­è€ƒ</option>
                    <option value="ä¸‹å­¸æœŸæœŸæœ«è€ƒ">ä¸‹å­¸æœŸæœŸæœ«è€ƒ</option>
                    <option value="å…¶ä»–">å…¶ä»– (è«‹åœ¨å§“åæ¬„å‚™è¨»)</option>
                </select>
            </div>

            <!-- æˆç¸¾è¼¸å…¥è¡¨æ ¼ -->
            <div class="grid grid-cols-3 gap-x-4 gap-y-4 text-center items-center">
                
                <!-- æ¨™é¡Œåˆ— -->
                <div class="font-bold text-base text-gray-800 self-end p-2">ç§‘ç›®</div>
                <div class="font-bold text-base text-indigo-700 self-end p-2 border-b border-indigo-300">å¯¦éš›æˆç¸¾</div>
                <div class="font-bold text-base text-teal-700 self-end p-2 border-b border-teal-300">é è¨ˆç›®æ¨™</div>

                <!-- åœ‹èª -->
                <label for="chinese" class="text-left font-medium text-gray-700 p-2">åœ‹èª</label>
                <input type="number" id="chinese" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500">
                <input type="number" id="chinese-expected" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-teal-500 focus:ring-teal-500">

                <!-- æ•¸å­¸ -->
                <label for="math" class="text-left font-medium text-gray-700 p-2">æ•¸å­¸</label>
                <input type="number" id="math" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500">
                <input type="number" id="math-expected" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-teal-500 focus:ring-teal-500">

                <!-- è‡ªç„¶ -->
                <label for="science" class="text-left font-medium text-gray-700 p-2">è‡ªç„¶</label>
                <input type="number" id="science" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500">
                <input type="number" id="science-expected" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-teal-500 focus:ring-teal-500">

                <!-- ç¤¾æœƒ -->
                <label for="social" class="text-left font-medium text-gray-700 p-2">ç¤¾æœƒ</label>
                <input type="number" id="social" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500">
                <input type="number" id="social-expected" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-teal-500 focus:ring-teal-500">

                <!-- è‹±æ–‡ -->
                <label for="english" class="text-left font-medium text-gray-700 p-2">è‹±æ–‡</label>
                <input type="number" id="english" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-indigo-500 focus:ring-indigo-500">
                <input type="number" id="english-expected" min="0" max="100" value="0"
                       class="subject-input w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:border-teal-500 focus:ring-teal-500">
            </div>
        </section>

        <!-- åçœé¸é …å€ -->
        <form id="reflection-form">
            <!-- è€ƒå‰æº–å‚™ (13é …) -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold text-indigo-600 mb-4">äºŒã€ è€ƒå‰æº–å‚™æª¢æ ¸ (13 é …)</h2>
                <div class="space-y-3 p-4 bg-indigo-50 rounded-xl">
                    <p class="text-sm font-medium text-indigo-800 mb-2">è«‹å‹¾é¸æ‚¨åœ¨è€ƒè©¦å‰ç¢ºå¯¦åšåˆ°çš„é …ç›®ï¼š</p>
                    <!-- Checkbox items (13é …) -->
                    <div class="flex items-start">
                        <input id="prep-2" type="checkbox" name="preparation" value="è€ƒè©¦å‰ï¼Œæˆ‘è£½ä½œäº†è©³ç´°çš„è®€æ›¸è¨ˆç•«ä¸¦ç¢ºå¯¦åŸ·è¡Œ" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-2" class="ml-3 text-gray-700">1. è€ƒè©¦å‰ï¼Œæˆ‘è£½ä½œäº†è©³ç´°çš„è®€æ›¸è¨ˆç•«ä¸¦ç¢ºå¯¦åŸ·è¡Œã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-3" type="checkbox" name="preparation" value="æˆ‘å¹³æ™‚æœ‰æŒ‰æ™‚å®Œæˆæ‰€æœ‰ä½œæ¥­" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-3" class="ml-3 text-gray-700">2. æˆ‘å¹³æ™‚æœ‰æŒ‰æ™‚å®Œæˆæ‰€æœ‰ä½œæ¥­ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-4" type="checkbox" name="preparation" value="å¹³å¸¸æœ‰éŒ¯çš„åœ°æ–¹æˆ‘éƒ½æœ‰ç¢ºå¯¦è¨‚æ­£" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-4" class="ml-3 text-gray-700">3. å¹³å¸¸æœ‰éŒ¯çš„åœ°æ–¹æˆ‘éƒ½æœ‰ç¢ºå¯¦è¨‚æ­£ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-5" type="checkbox" name="preparation" value="å……åˆ†ç†è§£äº†æ‰€æœ‰æ¦‚å¿µï¼Œè€Œä¸æ˜¯æ­»è¨˜ç¡¬èƒŒ" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-5" class="ml-3 text-gray-700">4. å……åˆ†ç†è§£äº†æ‰€æœ‰æ¦‚å¿µï¼Œè€Œä¸æ˜¯æ­»è¨˜ç¡¬èƒŒã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-6" type="checkbox" name="preparation" value="æˆ‘æœ‰åšè¤‡ç¿’å·æˆ–è©•é‡å·" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-6" class="ml-3 text-gray-700">5. æˆ‘æœ‰åšè¤‡ç¿’å·æˆ–è©•é‡å·ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-7" type="checkbox" name="preparation" value="è€ƒå‰æˆ‘é ç•™äº†å……è¶³çš„ä¼‘æ¯å’Œç¡çœ æ™‚é–“" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-7" class="ml-3 text-gray-700">6. è€ƒå‰æˆ‘é ç•™äº†å……è¶³çš„ä¼‘æ¯å’Œç¡çœ æ™‚é–“ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-8" type="checkbox" name="preparation" value="å°‡é‡é»çŸ¥è­˜é»æ¿ƒç¸®æˆè‡ªå·±çš„ç­†è¨˜æˆ–å¿ƒæ™ºåœ–" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-8" class="ml-3 text-gray-700">7. æˆ‘å°‡é‡é»çŸ¥è­˜é»æ¿ƒç¸®æˆè‡ªå·±çš„ç­†è¨˜æˆ–å¿ƒæ™ºåœ–ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-9" type="checkbox" name="preparation" value="æˆ‘æœ‰ç‰¹åˆ¥è¤‡ç¿’äº†è€å¸«æç¤ºçš„é‡é»" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-9" class="ml-3 text-gray-700">8. æˆ‘æœ‰ç‰¹åˆ¥è¤‡ç¿’äº†è€å¸«æç¤ºçš„é‡é»ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-10" type="checkbox" name="preparation" value="è€ƒå‰ä¸€å¤©å°‡æ–‡å…·ç‰©å“æº–å‚™å¦¥ç•¶" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-10" class="ml-3 text-gray-700">9. æˆ‘è€ƒå‰ä¸€å¤©å°‡æ–‡å…·ç‰©å“æº–å‚™å¦¥ç•¶ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-11" type="checkbox" name="preparation" value="é‡å°éå»çš„éŒ¯é¡Œèˆ‡è¨‚æ­£ç­†è¨˜é€²è¡Œè€ƒå‰ç¸½è¤‡ç¿’" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-11" class="ml-3 text-gray-700">10. æˆ‘é‡å°éå»çš„éŒ¯é¡Œèˆ‡è¨‚æ­£ç­†è¨˜é€²è¡Œè€ƒå‰ç¸½è¤‡ç¿’ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-12" type="checkbox" name="preparation" value="æˆ‘æ¯å¤©çš„è®€æ›¸æ™‚é–“éƒ½é”åˆ°è¨ˆç•«ä¸­çš„æ™‚æ•¸" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-12" class="ml-3 text-gray-700">11. æˆ‘æ¯å¤©çš„è®€æ›¸æ™‚é–“éƒ½é”åˆ°è¨ˆç•«ä¸­çš„æ™‚æ•¸ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-13" type="checkbox" name="preparation" value="æˆ‘æ’é™¤æ‰€æœ‰æœƒå½±éŸ¿è®€æ›¸æ•ˆç‡çš„åˆ†å¿ƒäº‹ç‰©(ä¾‹å¦‚æ‰‹æ©Ÿæ”¶èµ·ä¾†)" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-13" class="ml-3 text-gray-700">12. æˆ‘æ’é™¤æ‰€æœ‰æœƒå½±éŸ¿è®€æ›¸æ•ˆç‡çš„åˆ†å¿ƒäº‹ç‰©(ä¾‹å¦‚æ‰‹æ©Ÿæ”¶èµ·ä¾†)ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="prep-14" type="checkbox" name="preparation" value="æˆ‘å°‡è¤‡é›œçš„çŸ¥è­˜é»æ‹†è§£æˆå°å¡Šé€²è¡Œå­¸ç¿’" class="h-5 w-5 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 mt-1">
                        <label for="prep-14" class="ml-3 text-gray-700">13. æˆ‘å°‡è¤‡é›œçš„çŸ¥è­˜é»æ‹†è§£æˆå°å¡Šé€²è¡Œå­¸ç¿’ã€‚</label>
                    </div>
                </div>
            </section>

            <!-- è€ƒè©¦ä¸­è¡¨ç¾ (12é …) -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold text-indigo-600 mb-4">ä¸‰ã€ è€ƒè©¦ç•¶ä¸­çš„è¡¨ç¾ (12 é …)</h2>
                <div class="space-y-3 p-4 bg-yellow-50 rounded-xl">
                    <p class="text-sm font-medium text-yellow-800 mb-2">è«‹å‹¾é¸æ‚¨åœ¨è€ƒè©¦ä¸­ç¢ºå¯¦åšåˆ°çš„é …ç›®ï¼š</p>
                    <!-- Checkbox items (12é …) -->
                    <div class="flex items-start">
                        <input id="during-1" type="checkbox" name="during" value="ä»”ç´°é–±è®€äº†æ‰€æœ‰é¡Œç›®å’Œèªªæ˜" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-1" class="ml-3 text-gray-700">1. æˆ‘ä»”ç´°é–±è®€äº†æ‰€æœ‰é¡Œç›®å’Œèªªæ˜ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-2" type="checkbox" name="during" value="åˆç†åˆ†é…æ™‚é–“ï¼Œæ²’æœ‰èŠ±å¤ªå¤šæ™‚é–“åœ¨ä¸€é“é¡Œä¸Š" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-2" class="ml-3 text-gray-700">2. æˆ‘æœ‰åˆç†åˆ†é…æ™‚é–“ï¼Œæ²’æœ‰èŠ±å¤ªå¤šæ™‚é–“åœ¨ä¸€é“é¡Œä¸Šã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-3" type="checkbox" name="during" value="é‡åˆ°é›£é¡Œæ™‚ï¼Œèƒ½ä¿æŒå†·éœä¸¦å…ˆè·³é" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-3" class="ml-3 text-gray-700">3. æˆ‘é‡åˆ°é›£é¡Œæ™‚ï¼Œèƒ½ä¿æŒå†·éœä¸¦å…ˆè·³éã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-4" type="checkbox" name="during" value="æª¢æŸ¥äº†ç­”æ¡ˆï¼Œç¢ºèªæ²’æœ‰è¨ˆç®—æˆ–å¯«ä½œéŒ¯èª¤" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-4" class="ml-3 text-gray-700">4. æˆ‘æª¢æŸ¥äº†ç­”æ¡ˆï¼Œç¢ºèªæ²’æœ‰è¨ˆç®—æˆ–å¯«ä½œéŒ¯èª¤ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-5" type="checkbox" name="during" value="æ²’æœ‰å› ç‚ºéåº¦ç·Šå¼µè€Œå¿˜è¨˜å¹³å¸¸æœƒçš„æ±è¥¿" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-5" class="ml-3 text-gray-700">5. æˆ‘æ²’æœ‰å› ç‚ºéåº¦ç·Šå¼µè€Œå¿˜è¨˜å¹³å¸¸æœƒçš„æ±è¥¿ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-6" type="checkbox" name="during" value="é‡åˆ°ä¸æœƒçš„é¡Œç›®ï¼Œæœƒç”¨åˆªå»æ³•å˜—è©¦æ¨è«–ç­”æ¡ˆ" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-6" class="ml-3 text-gray-700">6. æˆ‘é‡åˆ°ä¸æœƒçš„é¡Œç›®ï¼Œæœƒç”¨åˆªå»æ³•å˜—è©¦æ¨è«–ç­”æ¡ˆã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-7" type="checkbox" name="during" value="æˆ‘åœ¨è¨ˆç®—æˆ–å¡«ç©ºæ™‚ï¼Œé¿å…äº†å–®ä½æˆ–æ¨™é»ç¬¦è™Ÿçš„éŒ¯èª¤" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-7" class="ml-3 text-gray-700">7. æˆ‘åœ¨è¨ˆç®—æˆ–å¡«ç©ºæ™‚ï¼Œé¿å…äº†å–®ä½æˆ–æ¨™é»ç¬¦è™Ÿçš„éŒ¯èª¤ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-8" type="checkbox" name="during" value="åœ¨è©¦å·ä¸Šåšäº†è¨˜è™Ÿï¼Œæ¨™è¨»ä¸ç¢ºå®šçš„é¡Œç›®å¾…æœƒæª¢æŸ¥" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-8" class="ml-3 text-gray-700">8. æˆ‘åœ¨è©¦å·ä¸Šåšäº†è¨˜è™Ÿï¼Œæ¨™è¨»ä¸ç¢ºå®šçš„é¡Œç›®å¾…æœƒæª¢æŸ¥ã€‚</label>
                    </div>
                    <!-- åŸ 12, 13, 14, 15 -->
                    <div class="flex items-start">
                        <input id="during-9" type="checkbox" name="during" value="æˆ‘çš„å°ˆæ³¨åŠ›èƒ½æŒçºŒåˆ°è€ƒè©¦çµæŸï¼Œæ²’æœ‰ä¸­é€”èµ°ç¥" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-9" class="ml-3 text-gray-700">9. æˆ‘çš„å°ˆæ³¨åŠ›èƒ½æŒçºŒåˆ°è€ƒè©¦çµæŸï¼Œæ²’æœ‰ä¸­é€”èµ°ç¥ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-10" type="checkbox" name="during" value="æ•¸å­¸æˆ–è¨ˆç®—é¡Œæœ‰å¯«ä¸‹å®Œæ•´çš„æ­¥é©Ÿï¼Œè€Œéåªå¯«ç­”æ¡ˆ" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-10" class="ml-3 text-gray-700">10. æˆ‘æ•¸å­¸æˆ–è¨ˆç®—é¡Œæœ‰å¯«ä¸‹å®Œæ•´çš„æ­¥é©Ÿï¼Œè€Œéåªå¯«ç­”æ¡ˆã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-11" type="checkbox" name="during" value="æˆ‘å……åˆ†åˆ©ç”¨äº†è©¦å·ä¸Šçš„ç©ºç™½è™•é€²è¡Œè¨ˆç®—æˆ–æ€è·¯è¦åŠƒ" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-11" class="ml-3 text-gray-700">11. æˆ‘å……åˆ†åˆ©ç”¨äº†è©¦å·ä¸Šçš„ç©ºç™½è™•é€²è¡Œè¨ˆç®—æˆ–æ€è·¯è¦åŠƒã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="during-12" type="checkbox" name="during" value="è€ƒè©¦æœŸé–“æœªå—å…¶ä»–åŒå­¸æˆ–ç’°å¢ƒçš„å½±éŸ¿è€Œåˆ†å¿ƒ" class="h-5 w-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500 mt-1">
                        <label for="during-12" class="ml-3 text-gray-700">12. æˆ‘è€ƒè©¦æœŸé–“æœªå—å…¶ä»–åŒå­¸æˆ–ç’°å¢ƒçš„å½±éŸ¿è€Œåˆ†å¿ƒã€‚</label>
                    </div>
                </div>
            </section>

            <!-- è€ƒå¾Œå½Œè£œæªæ–½ (9é …) -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold text-indigo-600 mb-4">å››ã€ è€ƒå¾Œæˆé•·è¦åŠƒèˆ‡è¡Œå‹• (9 é …)</h2>
                <div class="space-y-3 p-4 bg-green-50 rounded-xl">
                    <p class="text-sm font-medium text-green-800 mb-2">è«‹å‹¾é¸æ‚¨è¨ˆåŠƒæ¥ä¸‹ä¾†æœƒåšçš„è¡Œå‹•ï¼š</p>
                    <!-- Checkbox items (9é …) -->
                    
                    <div class="flex items-start">
                        <input id="after-1" type="checkbox" name="after" value="æˆ‘æœƒç‚ºé€™æ¬¡çš„åŠªåŠ›çµ¦äºˆè‡ªå·±é¼“å‹µ" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-1" class="ml-3 text-gray-700">1. æˆ‘æœƒç‚ºé€™æ¬¡çš„åŠªåŠ›çµ¦äºˆè‡ªå·±é¼“å‹µã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-2" type="checkbox" name="after" value="æˆ‘æœƒå°‡éŒ¯é¡Œæ•´ç†æˆç­†è¨˜æˆ–è²¼ä¸Šä¾¿åˆ©è²¼" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-2" class="ml-3 text-gray-700">2. æˆ‘æœƒå°‡éŒ¯é¡Œæ•´ç†æˆç­†è¨˜æˆ–è²¼ä¸Šä¾¿åˆ©è²¼ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-3" type="checkbox" name="after" value="æˆ‘æœƒå°‡æˆ‘éŒ¯é¡Œçš„åŸå› å€åˆ†æ˜¯æ¦‚å¿µä¸ç†è§£ã€å°é¡Œæ„èª¤è§£ã€é‹ç®—èˆ‡æ­¥é©Ÿçš„éŒ¯èª¤ã€å¿½ç•¥ç´°ç¯€çš„éŒ¯èª¤ã€ç­”æ¡ˆè¡¨é”ä¸å®Œæ•´ã€æ™‚é–“ä¸è¶³" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-3" class="ml-3 text-gray-700">3. æˆ‘æœƒå°‡æˆ‘éŒ¯é¡Œçš„åŸå› å€åˆ†æ˜¯æ¦‚å¿µä¸ç†è§£ã€å°é¡Œæ„èª¤è§£ã€é‹ç®—èˆ‡æ­¥é©Ÿçš„éŒ¯èª¤ã€å¿½ç•¥ç´°ç¯€çš„éŒ¯èª¤ã€ç­”æ¡ˆè¡¨é”ä¸å®Œæ•´ã€æ™‚é–“ä¸è¶³ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-4" type="checkbox" name="after" value="æˆ‘æœƒé‡å°ã€Œæ¦‚å¿µä¸ç†è§£ã€çš„éŒ¯é¡Œï¼Œé‡æ–°å•è€å¸«æˆ–æŸ¥è³‡æ–™ï¼ŒæŠŠå®ƒå¼„æ‡‚" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-4" class="ml-3 text-gray-700">4. æˆ‘æœƒé‡å°ã€Œæ¦‚å¿µä¸ç†è§£ã€çš„éŒ¯é¡Œï¼Œé‡æ–°å•è€å¸«æˆ–æŸ¥è³‡æ–™ï¼ŒæŠŠå®ƒå¼„æ‡‚ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-5" type="checkbox" name="after" value="æˆ‘æœƒå®šæœŸå›é¡§éŒ¯é¡Œæœ¬ï¼Œè€Œä¸æ˜¯åªç·´ç¿’ä¸€æ¬¡" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-5" class="ml-3 text-gray-700">5. æˆ‘æœƒå®šæœŸå›é¡§éŒ¯é¡Œæœ¬ï¼Œè€Œä¸æ˜¯åªç·´ç¿’ä¸€æ¬¡ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-6" type="checkbox" name="after" value="æˆ‘æœƒé‡å°å¼±é»ç§‘ç›®ï¼Œé¡å¤–å°‹æ‰¾ç›¸é—œçš„ç·´ç¿’è³‡æº" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-6" class="ml-3 text-gray-700">6. æˆ‘æœƒé‡å°å¼±é»ç§‘ç›®ï¼Œé¡å¤–å°‹æ‰¾ç›¸é—œçš„ç·´ç¿’è³‡æºã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-7" type="checkbox" name="after" value="æˆ‘è¦åŠƒäº†æ¯å¤©å›ºå®šçš„è¤‡ç¿’æ™‚é–“ï¼Œé˜²æ­¢éºå¿˜" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-7" class="ml-3 text-gray-700">7. æˆ‘è¦åŠƒäº†æ¯å¤©å›ºå®šçš„è¤‡ç¿’æ™‚é–“ï¼Œé˜²æ­¢éºå¿˜ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-8" type="checkbox" name="after" value="æˆ‘æœƒç‚ºä¸‹ä¸€æ¬¡è€ƒè©¦è¨­å®šäº†æ–°çš„ã€å¯è¡¡é‡çš„åˆ†æ•¸ç›®æ¨™" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-8" class="ml-3 text-gray-700">8. æˆ‘æœƒç‚ºä¸‹ä¸€æ¬¡è€ƒè©¦è¨­å®šäº†æ–°çš„ã€å¯è¡¡é‡çš„åˆ†æ•¸ç›®æ¨™ã€‚</label>
                    </div>
                    <div class="flex items-start">
                        <input id="after-9" type="checkbox" name="after" value="æˆ‘æœƒä¸€ä½µåŸ·è¡Œã€Œè€ƒå‰æº–å‚™ã€çš„äº‹é …" class="h-5 w-5 text-green-600 rounded border-gray-300 focus:ring-green-500 mt-1">
                        <label for="after-9" class="ml-3 text-gray-700">9. æˆ‘æœƒä¸€ä½µåŸ·è¡Œã€Œè€ƒå‰æº–å‚™ã€çš„äº‹é …ã€‚</label>
                    </div>
                </div>
            </section>

            <!-- ç”Ÿæˆåçœç¸½çµæŒ‰éˆ• -->
            <div class="text-center mt-8 space-y-4">
                <button type="button" onclick="generateReflection()"
                        class="w-full sm:w-auto px-8 py-3 bg-indigo-600 text-white font-semibold rounded-full shadow-lg hover:bg-indigo-700 transition duration-150 ease-in-out transform hover:scale-105">
                    ğŸš€ ç”Ÿæˆæˆ‘çš„åçœç¸½çµèˆ‡å»ºè­°
                </button>
                <button type="button" id="download-report-btn" onclick="downloadReflectionReport()"
                        class="w-full sm:w-auto px-8 py-3 bg-red-600 text-white font-semibold rounded-full shadow-lg hover:bg-red-700 transition duration-150 ease-in-out transform hover:scale-105 hidden">
                    ğŸ“¥ ä¸‹è¼‰åçœå ±å‘Š (.txt)
                </button>
                <button type="button" onclick="saveToFirestore()"
                        class="w-full sm:w-auto px-8 py-3 bg-green-600 text-white font-semibold rounded-full shadow-lg hover:bg-green-700 transition duration-150 ease-in-out transform hover:scale-105">
                    ğŸ’¾ è¨˜éŒ„åˆ°æˆ‘çš„æ•¸æ“šåº«
                </button>
                <div id="save-status" class="text-sm mt-2 text-gray-500 font-medium">æ­£åœ¨åˆå§‹åŒ–æ•¸æ“šåº«é€£ç·š...</div>
            </div>
        </form>

        <!-- ç¸½çµå ±å‘Šå€ -->
        <section id="summary-section" class="mt-12 pt-8 border-t border-indigo-300 hidden">
            <h2 class="text-3xl font-bold text-indigo-700 text-center mb-6">ğŸ“ æˆ‘çš„åçœå ±å‘Š</h2>
            <div id="summary-content" class="space-y-6 text-gray-700 p-6 bg-gray-50 rounded-xl shadow-inner">
                <!-- Summary content will be injected here -->
            </div>
        </section>
        
        <!-- æ­·å²è¨˜éŒ„å€ (å·²ç§»é™¤) -->

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- å…¨å±€ç‹€æ…‹èˆ‡å¸¸æ•¸ ---
        let db;
        let auth;
        let userId = null;
        
        // ç•«å¸ƒç’°å¢ƒå¼·åˆ¶ä½¿ç”¨çš„å…¨å±€è®Šæ•¸
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        const statusDiv = document.getElementById('save-status');

        const subjects = [
            { id: 'chinese', name: 'åœ‹èª' },
            { id: 'math', name: 'æ•¸å­¸' },
            { id: 'science', name: 'è‡ªç„¶' },
            { id: 'social', name: 'ç¤¾æœƒ' },
            { id: 'english', name: 'è‹±æ–‡' }
        ];

        const prepTotalItems = 13;
        const duringTotalItems = 12;
        const afterTotalItems = 9; 

        // --- Firebase åˆå§‹åŒ–èˆ‡ç™»å…¥ ---
        async function setupFirebase() {
            try {
                // setLogLevel('debug'); // é–‹å•Ÿ Firebase é™¤éŒ¯æ—¥èªŒ
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                userId = auth.currentUser?.uid || crypto.randomUUID();
                statusDiv.innerHTML = `âœ… æ•¸æ“šåº«å·²é€£ç·š (User ID: ${userId.substring(0, 8)}...)`;
                statusDiv.classList.remove('text-red-500');
                statusDiv.classList.add('text-green-600');

            } catch (error) {
                console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", error);
                statusDiv.innerHTML = 'âŒ æ•¸æ“šåº«é€£ç·šå¤±æ•—ï¼è«‹æª¢æŸ¥é…ç½®ã€‚';
                statusDiv.classList.remove('text-green-600');
                statusDiv.classList.add('text-red-500');
            }
        }
        setupFirebase();

        /**
         * æ”¶é›†æ‰€æœ‰æˆç¸¾å’Œæª¢æ ¸æ•¸æ“š
         * @returns {object} åŒ…å«æ‰€æœ‰çµæ§‹åŒ–æ•¸æ“šçš„ç‰©ä»¶
         */
        function collectFormData() {
            let totalActualScore = 0;
            let totalExpectedScore = 0;
            const scoresData = {};
            const lowScores = [];
            const unmetExpectations = [];
            const maxScore = 100;

            const studentName = document.getElementById('student-name').value.trim() || 'æœªè¼¸å…¥';
            const examPeriod = document.getElementById('exam-period').value || 'æœªé¸æ“‡';

            subjects.forEach(subject => {
                const actualInput = document.getElementById(subject.id);
                const expectedInput = document.getElementById(subject.id + '-expected');
                
                let actualScore = parseInt(actualInput.value) || 0;
                let expectedScore = parseInt(expectedInput.value) || 0;
                
                if (actualScore < 0 || actualScore > maxScore) actualScore = 0;
                if (expectedScore < 0 || expectedScore > maxScore) expectedScore = 0;

                totalActualScore += actualScore;
                totalExpectedScore += expectedScore; 
                
                if (actualScore < 60) lowScores.push(subject.name);
                if (actualScore < expectedScore) unmetExpectations.push(subject.name);

                // çµæ§‹åŒ–åˆ†æ•¸æ•¸æ“š
                scoresData[subject.id] = {
                    actual: actualScore,
                    expected: expectedScore
                };
            });
            
            const getCheckedValues = (name) => {
                return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`))
                            .map(input => input.value);
            };

            const prepChecked = getCheckedValues('preparation');
            const duringChecked = getCheckedValues('during');
            const afterChecked = getCheckedValues('after');

            return {
                timestamp: new Date(),
                studentName: studentName,
                examPeriod: examPeriod,
                totalActualScore,
                totalExpectedScore,
                averageActualScore: (totalActualScore / subjects.length).toFixed(2),
                lowScores: lowScores.join('ã€'),
                unmetExpectations: unmetExpectations.join('ã€'),
                scores: scoresData, // åŒ…å«æ‰€æœ‰ç§‘ç›®å¯¦éš›èˆ‡é è¨ˆåˆ†æ•¸çš„ç‰©ä»¶
                prepSummary: `${prepChecked.length}/${prepTotalItems}`,
                duringSummary: `${duringChecked.length}/${duringTotalItems}`,
                afterSummary: `${afterChecked.length}/${afterTotalItems}`,
                prepCheckedList: prepChecked, // å„²å­˜ç‚ºé™£åˆ—
                duringCheckedList: duringChecked, // å„²å­˜ç‚ºé™£åˆ—
                afterCheckedList: afterChecked, // å„²å­˜ç‚ºé™£åˆ—
            };
        }

        /**
         * ç”¢ç”Ÿä¸¦é¡¯ç¤ºåçœç¸½çµå ±å‘Šã€‚
         */
        function generateReflection() {
            const data = collectFormData();
            
            // é–¾å€¼è¨ˆç®— (Thresholds)
            const prepExcellentThreshold = 10;
            const prepDecentThreshold = 7;     
            const duringExcellentThreshold = 10;
            const duringDecentThreshold = 6;     
            const afterExcellentThreshold = 7;
            const afterDecentThreshold = 5;     

            const prepCheckedList = data.prepCheckedList;
            const duringCheckedList = data.duringCheckedList;
            const afterCheckedList = data.afterCheckedList;

            // ç¸½æˆç¸¾å€å¡Šï¼šé¡¯ç¤ºå¯¦éš›èˆ‡é è¨ˆåˆ†æ•¸ (å·²ä¿®æ”¹ç‚ºåŒ…å«é¡è‰²å’Œè¡¨æƒ…ç¬¦è™Ÿ)
            const scoresHtml = subjects.map(subject => {
                const actual = data.scores[subject.id].actual;
                const expected = data.scores[subject.id].expected;
                
                let feedbackClass = 'text-gray-900 bg-gray-200';
                let emoji = '';
                
                if (actual > expected) {
                    feedbackClass = 'text-green-800 bg-green-200';
                    emoji = ' ğŸ†'; // çç›ƒ
                } else if (actual < expected) {
                    feedbackClass = 'text-red-800 bg-red-200';
                    emoji = ' â—'; // é©šå˜†è™Ÿ
                }
                
                return `<span class="inline-block ${feedbackClass} font-medium px-3 py-1 rounded-full text-sm">${subject.name}ï¼šå¯¦éš› ${actual}åˆ† / é è¨ˆ ${expected}åˆ†${emoji}</span>`;
            }).join('');


            let summaryText = `<div class="p-4 border-l-4 border-indigo-500 bg-indigo-100 rounded-lg">
                                <h3 class="text-xl font-bold text-indigo-800 mb-2">ğŸ“ æˆç¸¾ç¸½è¦½ï¼š</h3>
                                <p class="mb-2">å­¸ç”Ÿå§“åï¼š<span class="font-semibold text-xl text-indigo-700">${data.studentName}</span> / è€ƒè©¦é¡å‹ï¼š<span class="font-semibold text-xl text-indigo-700">${data.examPeriod}</span></p>
                                <p class="mb-2">å¯¦éš›ç¸½åˆ†ï¼š<span class="font-semibold text-2xl text-indigo-700">${data.totalActualScore}</span> åˆ† (å¹³å‡ ${data.averageActualScore} åˆ†)</p>
                                <p class="mb-2">é è¨ˆç¸½åˆ†ï¼š<span class="font-semibold text-2xl text-teal-700">${data.totalExpectedScore}</span> åˆ† (å¹³å‡ ${(data.totalExpectedScore / subjects.length).toFixed(2)} åˆ†)</p>
                                <div class="flex flex-wrap gap-2">${scoresHtml}</div>
                                ${data.lowScores ? 
                                `<p class="mt-4 font-bold text-red-600">ğŸš¨ å¾…åŠ å¼·ç§‘ç›® (å¯¦éš›ä½æ–¼ 60 åˆ†)ï¼š${data.lowScores}</p>` : 
                                `<p class="mt-4 font-medium text-green-600">ğŸ‰ å¯¦éš›æˆç¸¾çš†é”åˆ° 60 åˆ†ä»¥ä¸Šï¼</p>`
                                }
                                ${data.unmetExpectations ?
                                `<p class="mt-2 font-bold text-orange-600">âš ï¸ æœªé”é æœŸç§‘ç›®ï¼š${data.unmetExpectations}</p>` :
                                `<p class="mt-2 font-medium text-blue-600">ğŸ‘ å¯¦éš›æˆç¸¾çš†é”åˆ°æˆ–è¶…è¶Šé æœŸç›®æ¨™ï¼</p>`
                                }
                               </div>`;

            // è€ƒå‰åçœ
            let prepFeedback = 'æ‚¨çš„æº–å‚™å¯èƒ½æœ‰äº›ä¸è¶³ï¼Œéœ€è¦æ›´è©³ç´°çš„è¨ˆç•«ã€‚';
            if (prepCheckedList.length >= prepExcellentThreshold) { 
                prepFeedback = 'æ‚¨è€ƒå‰æº–å‚™éå¸¸å……åˆ†ï¼é€™ç‚ºæ‚¨æ‰“ä¸‹äº†å …å¯¦çš„åŸºç¤ã€‚';
            } else if (prepCheckedList.length >= prepDecentThreshold) { 
                prepFeedback = 'æ‚¨çš„æº–å‚™ç›¸å°åˆ°ä½ï¼Œä½†ä»æœ‰é€²æ­¥ç©ºé–“ã€‚å¯ä»¥æª¢è¦–æœªå‹¾é¸çš„é …ç›®ä¾†å„ªåŒ–ã€‚';
            }
            summaryText += `<div class="mt-6">
                                <h3 class="text-xl font-bold text-indigo-700 mb-2">ğŸ’¡ è€ƒå‰æº–å‚™åæ€ (${data.prepSummary})ï¼š</h3>
                                <p>${prepFeedback}</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 ml-4">
                                    ${prepCheckedList.map(v => `<li class="text-green-700 font-medium">${v} (å·²åšåˆ°)</li>`).join('')}
                                    ${Array.from(document.querySelectorAll('input[name="preparation"]:not(:checked)'))
                                            .map(input => `<li class="text-red-700">${input.value} (å¾…åŠ å¼·)</li>`).join('')}
                                </ul>
                            </div>`;

            // è€ƒè©¦ä¸­è¡¨ç¾
            let duringFeedback = 'æ‚¨å¯èƒ½éœ€è¦ç·´ç¿’ç©©å®šæƒ…ç·’æˆ–åˆ†é…æ™‚é–“çš„æŠ€å·§ã€‚';
            if (duringCheckedList.length >= duringExcellentThreshold) {
                duringFeedback = 'æ‚¨åœ¨è€ƒå ´ä¸Šè¡¨ç¾ç©©å®šè€Œå°ˆæ³¨ï¼èƒ½å°‡å¯¦åŠ›å®Œæ•´ç™¼æ®ã€‚';
            } else if (duringCheckedList.length >= duringDecentThreshold) {
                duringFeedback = 'æ‚¨çš„è‡¨å ´è¡¨ç¾ä¸éŒ¯ï¼Œä½†è¦æ³¨æ„ç´°ç¯€ï¼Œå¦‚æª¢æŸ¥æˆ–åˆ†é…æ™‚é–“ã€‚';
            }
            summaryText += `<div class="mt-6">
                                <h3 class="text-xl font-bold text-indigo-700 mb-2">â±ï¸ è€ƒè©¦è‡¨å ´è¡¨ç¾ (${data.duringSummary})ï¼š</h3>
                                <p>${duringFeedback}</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 ml-4">
                                    ${duringCheckedList.map(v => `<li class="text-green-700 font-medium">${v} (å·²åšåˆ°)</li>`).join('')}
                                    ${Array.from(document.querySelectorAll('input[name="during"]:not(:checked)'))
                                            .map(input => `<li class="text-red-700">${input.value} (å¾…åŠ å¼·)</li>`).join('')}
                                </ul>
                            </div>`;

            // è€ƒå¾Œå½Œè£œæªæ–½
            let afterFeedback = 'è«‹ç«‹å³è¦åŠƒä¸¦é–‹å§‹åŸ·è¡Œé€™äº›è¨‚æ­£å’Œèª¿æ•´çš„è¡Œå‹•ï¼Œé€™æ˜¯é€²æ­¥çš„é—œéµï¼';
            if (afterCheckedList.length >= afterExcellentThreshold) {
                afterFeedback = 'å¤ªæ£’äº†ï¼æ‚¨å·²ç¶“æ“æœ‰å®Œæ•´çš„æˆé•·è—åœ–ï¼Œå …æŒä¸‹å»å¿…æœ‰æ”¶ç©«ã€‚';
            } else if (afterCheckedList.length >= afterDecentThreshold) {
                afterFeedback = 'æ‚¨çš„å¾ŒçºŒè¡Œå‹•å·²ç¶“å•Ÿå‹•ï¼Œè¨˜å¾—å …æŒåŸ·è¡Œï¼Œä¸¦è®“é€™äº›è¡Œå‹•æˆç‚ºç¿’æ…£ã€‚';
            }
            summaryText += `<div class="mt-6">
                                <h3 class="text-xl font-bold text-indigo-700 mb-2">ğŸ¯ è€ƒå¾Œæˆé•·è¦åŠƒ (${data.afterSummary})ï¼š</h3>
                                <p>${afterFeedback}</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 ml-4">
                                    ${afterCheckedList.map(v => `<li class="text-green-700 font-medium">${v} (å°‡åŸ·è¡Œ)</li>`).join('')}
                                </ul>
                            </div>`;
            
            // ç¸½çµå»ºè­°
            const recommendation = data.lowScores || data.unmetExpectations
                ? `å»ºè­°æ‚¨å„ªå…ˆé‡å° <span class="text-red-600 font-bold">${data.lowScores.replace(/ \(.+\)/g, '').split('ã€').filter(n=>n).join('ã€')}</span> é€²è¡ŒéŒ¯é¡Œåˆ†æå’Œå¼·åŒ–è¨“ç·´ã€‚ç‰¹åˆ¥æ˜¯é‡å°æœªé”é æœŸçš„ç§‘ç›®ï¼Œéœ€è¦ä»”ç´°åçœæº–å‚™èˆ‡æ‡‰è©¦éç¨‹ä¸­çš„ç¼ºå¤±ã€‚åŒæ™‚ï¼Œå°‡ä¸‰å€‹é¢å‘ä¸­æœªå‹¾é¸çš„ã€Œå¾…åŠ å¼·ã€é …ç›®åŠ å…¥åˆ°æ‚¨çš„ä¸‹ä¸€å€‹è®€æ›¸è¨ˆç•«ä¸­ã€‚`
                : `æ•´é«”è¡¨ç¾è‰¯å¥½ï¼Œå¯¦éš›æˆç¸¾çš†é”åˆ°æˆ–è¶…è¶Šé æœŸç›®æ¨™ï¼Œå¯é€²ä¸€æ­¥æŒ‘æˆ°è‡ªæˆ‘ï¼Œå°‡éŒ¯é¡ŒåŸå› åˆ†é¡ï¼Œæå‡å­¸ç¿’æ·±åº¦ï¼Œä¸¦ä¸»å‹•å¹«å¿™å…¶ä»–åŒå­¸ã€‚`;

            summaryText += `<div class="mt-8 p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-lg">
                                <h3 class="text-xl font-bold text-yellow-800 mb-2">ğŸŒŸ ç¸½çµèˆ‡ä¸‹ä¸€æ­¥è¡Œå‹•å»ºè­°ï¼š</h3>
                                <p class="text-gray-800">${recommendation}</p>
                            </div>`;


            // 4. é¡¯ç¤ºç¸½çµå ±å‘Š
            document.getElementById('summary-content').innerHTML = summaryText;
            document.getElementById('summary-section').classList.remove('hidden');
            
            // é¡¯ç¤ºä¸‹è¼‰æŒ‰éˆ•
            document.getElementById('download-report-btn').classList.remove('hidden');

            // æ²å‹•åˆ°ç¸½çµå€
            document.getElementById('summary-section').scrollIntoView({ behavior: 'smooth' });
        }
        
        /**
         * å°‡åçœå ±å‘Šæ•¸æ“šç™¼é€åˆ° Firestore æ•¸æ“šåº«ã€ä¸¦åŒæ­¥ç™¼é€åˆ° Apps Script è©¦ç®—è¡¨ã€‘ã€‚
         */
        async function saveToFirestore() {
            // !!! è«‹å°‡æ­¤è™•æ›¿æ›ç‚ºæ‚¨åœ¨ Apps Script éƒ¨ç½²ä¸­å–å¾—çš„ Web æ‡‰ç”¨ç¨‹å¼ç¶²å€ !!!
            const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzheAfU1ZgVvyp9BkpMHbuPvlU0gc5bLYSbx5mp0vLyJ7bkG2bDDvAUB321_hS6_xDIKA/exec';
            // !!! -------------------------------------------------------- !!!


            if (!db || !userId) {
                statusDiv.innerHTML = 'âš ï¸ æ•¸æ“šåº«å°šæœªé€£ç·šæˆåŠŸï¼Œè«‹ç¨å€™å†è©¦ã€‚';
                statusDiv.classList.remove('text-green-600');
                statusDiv.classList.add('text-red-500');
                return;
            }

            statusDiv.innerHTML = 'ğŸ“ æ­£åœ¨å„²å­˜å ±å‘Šåˆ°æ•¸æ“šåº«...';
            statusDiv.classList.remove('text-red-500', 'text-green-600');
            statusDiv.classList.add('text-blue-500');

            try {
                const recordData = collectFormData();
                
                // --- 1. ç§äººå„²å­˜ (å®Œæ•´æ•¸æ“š) ---
                const privateCollectionPath = `artifacts/${appId}/users/${userId}/reflection_records`;
                await addDoc(collection(db, privateCollectionPath), recordData);
                
                // --- 2. å…¬é–‹å„²å­˜ (è©¦ç®—è¡¨æ‘˜è¦æ•¸æ“š) ---
                // æ•¸æ“šçµæ§‹åŒ–ï¼Œé¿å…é™£åˆ—å’Œè¤‡é›œå·¢ç‹€
                const scoresSummary = {};
                subjects.forEach(subj => {
                    scoresSummary[`${subj.name}å¯¦éš›`] = recordData.scores[subj.id].actual;
                    scoresSummary[`${subj.name}é è¨ˆ`] = recordData.scores[subj.id].expected;
                });

                const summaryData = {
                    timestamp: recordData.timestamp,
                    studentName: recordData.studentName,
                    examPeriod: recordData.examPeriod,
                    averageActualScore: recordData.averageActualScore,
                    ...scoresSummary, // æ‰å¹³åŒ–çš„åˆ†æ•¸æ•¸æ“š
                    lowScores: recordData.lowScores,
                    unmetExpectations: recordData.unmetExpectations,
                    prepSummary: recordData.prepSummary,
                    duringSummary: recordData.duringSummary,
                    afterSummary: recordData.afterSummary,
                    userId: userId 
                };
                
                // ä½¿ç”¨å…¬é–‹é›†åˆè·¯å¾‘
                const publicCollectionPath = `artifacts/${appId}/public/data/all_reflections_summary`;
                await addDoc(collection(db, publicCollectionPath), summaryData);

                
                // --- 3. ç™¼é€æ•¸æ“šåˆ° Apps Script Web App (åŒæ­¥åˆ° Google Sheet) ---
                let sheetSyncSuccess = true;
                if (APPS_SCRIPT_URL.includes('https://script.google.com/macros/')) {
                    try {
                        const sheetResponse = await fetch(APPS_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'cors',
                            cache: 'no-cache',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(recordData) // ç™¼é€å®Œæ•´æ•¸æ“šï¼Œè®“ Apps Script è² è²¬æ”¤å¹³
                        });

                        if (!sheetResponse.ok) {
                            const errorText = await sheetResponse.text();
                            throw new Error(`Apps Script POST failed: ${errorText}`);
                        }
                    } catch (error) {
                        sheetSyncSuccess = false;
                        console.error('Apps Script åŒæ­¥å¤±æ•—:', error);
                    }
                } else {
                    sheetSyncSuccess = false;
                }
                
                // æ ¹æ“šåŒæ­¥çµæœæ›´æ–°ç‹€æ…‹
                if (sheetSyncSuccess) {
                    statusDiv.innerHTML = 'âœ… å„²å­˜æˆåŠŸï¼è¨˜éŒ„å·²åŒæ­¥åˆ° Google Sheetã€‚';
                } else if (APPS_SCRIPT_URL.includes('YOUR_APPS_SCRIPT_WEB_APP_URL')) {
                    statusDiv.innerHTML = 'âœ… å„²å­˜æˆåŠŸï¼(è«‹æ³¨æ„ï¼šApps Script URL å°šæœªè¨­ç½®ï¼Œè©¦ç®—è¡¨åŒæ­¥åŠŸèƒ½æœªå•Ÿç”¨)';
                } else {
                     statusDiv.innerHTML = 'âœ… å„²å­˜æˆåŠŸï¼ä½† Google Sheet åŒæ­¥å¤±æ•— (è©³æƒ…è«‹çœ‹ console)ã€‚';
                }

                statusDiv.classList.remove('text-blue-500');
                statusDiv.classList.add('text-green-600');
            } catch (error) {
                console.error('å„²å­˜åˆ° Firestore å¤±æ•—:', error);
                statusDiv.innerHTML = `âŒ å„²å­˜å¤±æ•—ï¼éŒ¯èª¤: ${error.message}`;
                statusDiv.classList.remove('text-blue-500');
                statusDiv.classList.add('text-red-500');
            }
        }
        
        /**
         * âš ï¸ å·²ç§»é™¤ï¼š loadReflectionHistory() 
         */
        
        /**
         * å°‡åçœå ±å‘Šå…§å®¹è½‰æ›ç‚ºç´”æ–‡å­—æª”æ¡ˆ (.txt) ä¸¦ä¸‹è¼‰ã€‚
         */
        function downloadReflectionReport() {
            const summarySection = document.getElementById('summary-section');
            const summaryContent = document.getElementById('summary-content');

            if (summarySection.classList.contains('hidden') || summaryContent.innerHTML === '') {
                console.warn('è«‹å…ˆç”Ÿæˆåçœå ±å‘Šå†å˜—è©¦ä¸‹è¼‰ï¼');
                statusDiv.innerHTML = 'âš ï¸ è«‹å…ˆç”Ÿæˆåçœå ±å‘Šå†å˜—è©¦ä¸‹è¼‰ï¼';
                statusDiv.classList.remove('text-green-600', 'text-blue-500');
                statusDiv.classList.add('text-red-500');
                return;
            }

            // å–å¾—å ±å‘Šå…§å®¹ (åŒ…å« HTML)
            const reportHtml = summaryContent.innerHTML;
            
            // å‰µå»ºä¸€å€‹è‡¨æ™‚ div ä¾†å‰é›¢ HTML æ¨™ç±¤ï¼Œä¸¦é€²è¡Œæ ¼å¼åŒ–
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = reportHtml;

            // æ›¿æ› HTML çµæ§‹ç‚ºç´”æ–‡æœ¬æ ¼å¼ï¼Œä¸¦èª¿æ•´æ ¼å¼ä½¿å…¶æ›´æ˜“é–±è®€
            let reportText = tempDiv.textContent || tempDiv.innerText || "";
            
            // é€²ä¸€æ­¥æ¸…ç†å’Œæ ¼å¼åŒ–ï¼š
            reportText = reportText.replace(/\n\s*\n/g, '\n\n'); // ç§»é™¤å¤šé¤˜ç©ºç™½è¡Œ
            reportText = reportText.replace(/ğŸ“ æˆç¸¾ç¸½è¦½ï¼š/g, '=========================================\n\nğŸ“ æˆç¸¾ç¸½è¦½ï¼š\n');
            reportText = reportText.replace(/ğŸ’¡ è€ƒå‰æº–å‚™åæ€/g, '\n=========================================\nğŸ’¡ è€ƒå‰æº–å‚™åæ€');
            reportText = reportText.replace(/â±ï¸ è€ƒè©¦è‡¨å ´è¡¨ç¾/g, '\n=========================================\nâ±ï¸ è€ƒè©¦è‡¨å ´è¡¨ç¾');
            reportText = reportText.replace(/ğŸ¯ è€ƒå¾Œæˆé•·è¦åŠƒ/g, '\n=========================================\nğŸ¯ è€ƒå¾Œæˆé•·è¦åŠƒ');
            reportText = reportText.replace(/ğŸŒŸ ç¸½çµèˆ‡ä¸‹ä¸€æ­¥è¡Œå‹•å»ºè­°ï¼š/g, '\n\n=========================================\nğŸŒŸ ç¸½çµèˆ‡ä¸‹ä¸€æ­¥è¡Œå‹•å»ºè­°ï¼š\n');
            reportText = reportText.replace(/\(å·²åšåˆ°\)/g, ' [å·²åšåˆ°]');
            reportText = reportText.replace(/\(å¾…åŠ å¼·\)/g, ' [å¾…åŠ å¼·]');
            reportText = reportText.replace(/\(å°‡åŸ·è¡Œ\)/g, ' [å°‡åŸ·è¡Œ]');
            reportText = reportText.replace(/ğŸ†/g, ' [è¡¨ç¾å„ªç•°]');
            reportText = reportText.replace(/â—/g, ' [æœªé”ç›®æ¨™]');
            
            // ç²å–æ–‡ä»¶å
            const studentName = document.getElementById('student-name').value.trim() || 'å­¸ç”Ÿ';
            const examPeriod = document.getElementById('exam-period').value || 'è€ƒè©¦åçœ';
            const filename = `${studentName}_${examPeriod}_åçœå ±å‘Š.txt`;

            // å‰µå»º Blob å’Œä¸‹è¼‰é€£çµ
            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            
            // æ¨¡æ“¬é»æ“Šä¸‹è¼‰
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // æ¸…ç† URL
            URL.revokeObjectURL(url);
            
            statusDiv.innerHTML = `ğŸ‰ å ±å‘Šå·²æˆåŠŸä¸‹è¼‰ç‚º ${filename}ã€‚`;
            statusDiv.classList.remove('text-red-500', 'text-blue-500');
            statusDiv.classList.add('text-green-600');
        }

        /**
         * âš ï¸ å·²ç§»é™¤ï¼š exportAllRecordsToCsv()
         */


        // å°‡é‡è¦å‡½æ•¸æš´éœ²çµ¦ HTML çš„ onclick äº‹ä»¶
        window.generateReflection = generateReflection;
        window.saveToFirestore = saveToFirestore;
        window.downloadReflectionReport = downloadReflectionReport;
    </script>
</body>
</html>